<!--
EM CASO DE AUDITORIA:
  Da maneira como este código-fonte se encontra implementado, a semente utilizada na geração de números pseudo-aleatórios é o tempo (quantos milissegundos se passaram desde 1 de Janeiro de 1970 até o momento em que o botão "Gerar lista" foi clicado). Assim, cada vez que se clica no botão "Gerar lista", uma lista diferente é gerada, sendo o tempo o fator que torna a lista pseudo-aleatória em lista realmente aleatória.
  Caso deseje verificar a autenticidade da lista impressa publicada usando a semente fixa que aparece ao final dela, siga os seguintes passos:
    1) Faça busca neste código-fonte por três asteriscos (***), contidos em comentários, e siga todas as instruções de alteração;
    2) Utilize a semente de geração de números pseudo-aleatórios que lhe foi fornecida ao final da lista impressa em papel e assinada pelas testemunhas do processo seletivo;
    3) Efetue a comparação da saída do programa com a lista impressa publicada.
-->
<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>Sorteio Eletrônico</title>
<script src=seedrandom.js></script>
<script>

function gereEImprimaResultado() {
	var nomeCurso = document.sorteio.nomeCurso.value;
	var inscritos = document.sorteio.totalInscritos.value;
	var semente;
	if(document.sorteio.sementeManual.checked) {
		semente = parseInt(document.sorteio.semente.value);
	} else {
		semente = new Date().getTime();
	}
	var vagas = document.sorteio.vagas.value;
	var embaralhada = gereListaEmbaralhada(inscritos, semente);
	//var pontoImpressao = //document.sorteio.textArea;
	var pontoImpressao = document.getElementById('resultado');
	imprimaResultado(nomeCurso, semente, embaralhada, vagas, pontoImpressao);
}

function gereListaEmbaralhada(inscritos, semente){
	Math.seedrandom(semente);
	var consumida = new Array(inscritos);
	var resultado = new Array(inscritos);
	for(var i = 0; i < inscritos; i++) {
		consumida[i] = 1+i;
		resultado[i] = 0;
	}

	for(var i = 0; i < inscritos; i++) {
		var aleatorio = Math.floor(Math.random()*inscritos);
		while(consumida[aleatorio] == 0) {
			aleatorio = (1+aleatorio)%inscritos;
		}
		resultado[i] = consumida[aleatorio];
		consumida[aleatorio] = 0;
	}
	
	return resultado;
}

function imprimaResultado(nomeCurso, semente, embaralhada, vagas, pontoImpressao) {
	var conteudo = "";
	conteudo += gereVisualDeCabecalhoDaLista(nomeCurso, semente);
	conteudo += gereVisualDeListaDeSelecionados(embaralhada, vagas);
	conteudo += gereVisualDeCabecalhoDaEspera(nomeCurso);
	conteudo += gereVisualDeListaDeEspera(embaralhada, vagas);
	conteudo += gereVisualDeFim();
	conteudo += gereVisualDeInformacoesTecnicas(semente);
	//pontoImpressao.value = conteudo;
	pontoImpressao.innerHTML = conteudo;
}

function gereVisualDeCabecalhoDaLista(nomeCurso, semente){
	var data = new Date(semente);
	return "Horário do sorteio: " + data.getDate() + "/" + (pad(data.getMonth()+1)) + "/" + pad(data.getFullYear()) + ", " + pad(data.getHours()) + ":" + pad(data.getMinutes()) + ":" + pad(data.getSeconds()) + ".<H1>Lista <b>OFICIAL</b> do sorteio - " + nomeCurso + "</H1><H2>Primeira chamada</H2>";

}

function gereVisualDeListaDeSelecionados(lista, ultimaPosicao){
	var conteudo = "";
	for(var i = 0; i < ultimaPosicao; i++){
		conteudo += "<font size='6'><tt><b>" + lista[i] + "</b>" + padSpaces(lista[i], lista.length) + "(" + (i+1) + "º)</tt></font>";

		if(i < ultimaPosicao - 1){
			conteudo += "<br/>";
		}
	}
	return conteudo;
}

function gereVisualDeCabecalhoDaEspera(nomeCurso){
	return "<H2>Lista de Espera - " + nomeCurso + "</H2>";
}

function gereVisualDeListaDeEspera(lista, ultimaPosicao){
	var conteudo = "";
	for(var i = ultimaPosicao; i < lista.length; i++){
		conteudo += "<font size='5'><tt>" + lista[i] + padSpaces(lista[i], lista.length) + "(" + (parseInt(i)+1) + "º)</tt></font>";

		if(i < lista.length - 1){
			conteudo += "<br/>";
		}
	}
	return conteudo;
}

function gereVisualDeFim() {
	return "<br/><b>FIM.</b>";
}

function gereVisualDeInformacoesTecnicas(semente) {
	var conteudo = "<H3>Informações técnicas do sistema</H3>";
	conteudo += "<b>platform:</b> " + navigator.platform + "<br/>";
	conteudo += "<b>appName:</b> " + navigator.appName + "<br/>";
	conteudo += "<b>appVersion:</b> " + navigator.appVersion + "<br/>";
	conteudo += "<b>userAgent:</b> " + navigator.userAgent + "<br/>";
	conteudo += "<b>Versão deste sistema:</b> 20/01/2011<br/>"
	conteudo += "<b>Semente utilizada:</b> \"" + semente + "\"<br/>";
	return conteudo;
}

function pad(number) {
     return (number < 10 ? '0' : '') + number;
   
}

function padSpaces(atual, maximo) {
     var conteudo = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
     var espacosExtras = (maximo + "").length-(atual + "").length;

     for(var i = 1; i <= espacosExtras; i++){
        conteudo += "&nbsp;";
     }

     return conteudo;
}

</script>
</head>
<body>
<img src="logo.jpg" />
 <form name="sorteio">
  <table border=0>
   <tr>
    <td>
     Curso: 
    </td>
    <td colspan=3>
    <input type="text" name="nomeCurso" size=75 maxlength=100>
    </td>
   </tr>
   <tr>
    <td>
     Total de Inscritos: 
    </td>
    <td colspan=1>
    <input type="text" name="totalInscritos" size=10 maxlength=5>
    </td>
    <td>
     Vagas: 
    </td>
    <td colspan=2>
    <input type="text" name="vagas" size=10 maxlength=5>
    </td>
   </tr>
   <tr>
    <td>
    <input type="button" value="Gerar Lista" onclick="gereEImprimaResultado()">
    </td>
    <td width=270>
<!--***EM CASO DE AUDITORIA: TROQUE O VALOR DE style DE 'visibility:hidden' para 'visibility:visible', e descomente o texto "Inserir semente manualmente", que aparece abaixo***-->
    <input type="checkbox" name="sementeManual" onclick="document.sorteio.semente.disabled = !this.checked;" style='visibility:visible'>Inserir semente manualmente
    </td>
    <td>
<!--***EM CASO DE AUDITORIA: Descomente o texto "Semente: ", que aparece abaixo***-->
Semente:
    </td>
    <td>
<!--***EM CASO DE AUDITORIA: TROQUE O VALOR DE style DE 'visibility:hidden' para 'visibility:visible'***-->
    <input type="text" name="semente" size=20 maxlength=50 disabled style='visibility:visible'>
    </td>
   </tr>
  </table>
  <p id="resultado"></p>
 <!--<textarea name="textArea" rows=26 cols=92 readonly>
 </textarea>-->
 </form>
</body>
</html>
